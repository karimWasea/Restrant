@model Cf_Viewmodels.PriceProductebytypesVM
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    Layout = "_Layout";
    ViewData["Title"] = "PriceProductebytypes";
}

<partial name="_AlertMessage" />

<div class="d-flex align-items-center justify-content-center min-vh-100">
    <div class="container text-center">
        <h2 class="mb-4" style="font-size: 2rem;">انهاء الدين</h2>
        <form method="get" asp-controller="PriceProductebytypes" asp-action="GetDibts" asp-area="Admin" class="mt-4">
            <div class="form-row justify-content-center">
                <div class="col-md-4 mb-3">
                    <label for="NotpayedUserid" class="form-label" style="font-size: 1.2rem;">اختر العميل</label>
                    <select id="NotpayedUserid" name="NotpayedUserid" class="form-select" asp-items="Model.UsersLists" aria-required="true" style="font-size: 1.2rem;">
                        <option value="">اختر</option>
                    </select>
                </div>
            </div>

            <div class="form-row justify-content-center">
                <div class="col-md-4">
                    <button class="btn btn-primary w-100" type="submit" style="font-size: 1.2rem;">عرض</button>
                </div>
            </div>
        </form>
        <img src="~/Images/WhatsApp Image 2024-06-23 at 18.02.40_35881d78.jpg" class="circular-img" width="100" style="margin-right:500px;" />

        <div class="form-row justify-content-center mt-4">
            <div class="col-md-4">
                <div class="card p-3">
                    <div class="mb-2" style="font-size: 1.2rem;">اسم العميل: @Model.NotpayedUserName</div>
                    <div style="font-size: 1.2rem;">المطلوب دفعه: @Model.totalDibte جنيه</div>
                </div>
            </div>
        </div>

        <div class="form-row justify-content-center mt-4">
            <div class="col-md-4">
                <button onclick="submitDebtForm()" class="btn btn-primary w-100" style="font-size: 1.2rem;">انهاء الفواتير غير المدفوعه للاشخاص</button>
            </div>
        </div>

        <div class="form-row justify-content-center mt-4">
            <div class="col-md-4">
                <a asp-action="GetDibtsHospital" asp-controller="PriceProductebytypes" asp-area="Admin" class="btn btn-primary w-100" style="font-size: 1.2rem;">عرض مجموع الفواتير على المستشفى</a>
            </div>
        </div>

        <div class="form-row justify-content-center mt-4">
            <div class="col-md-4">
                <div class="card p-3">
                    <div style="font-size: 1.2rem;">المطلوب دفعه: @Model.totalDibtehospital جنيه</div>
                </div>
            </div>
        </div>

        <div class="form-row justify-content-center mt-4">
            <div class="col-md-4">
                <a asp-action="EnDDebiteForHospital" asp-controller="PriceProductebytypes" asp-area="Admin" class="btn btn-primary w-100" style="font-size: 1.2rem;">انهاء الفواتير غير المدفوعه المستشفى</a>
            </div>
        </div>
    </div>
</div>

<script>
    function submitDebtForm() {
        var userId = document.getElementById("NotpayedUserid").value;
        if (userId === "") {
            alert("الرجاء اختيار العميل");
            return;
        }

        fetch(`/Admin/PriceProductebytypes/EnDDebiteForPersone?NotpayedUserid=${userId}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("تم انهاء الدين بنجاح.");
                    // Optionally, update the UI or redirect
                } else {
                    alert("حدث خطأ أثناء إنهاء الدين.");
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("حدث خطأ أثناء إنهاء الدين.");
            });
    }
</script>
